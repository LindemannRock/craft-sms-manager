{#
 # Index Listing Macros
 #
 # Reusable macros for index listing pages (providers, senderids).
 # Colors are built-in - no need to pass them as parameters.
 #
 # Usage:
 #   {% import 'sms-manager/_macros/index' as indexMacros %}
 #   {{ indexMacros.sourceBadge('config') }}
 #   {{ indexMacros.statusBadge(true) }}
 #}

{# =========================================================================
   SOURCE BADGE
   Renders Config/Database source badge with built-in colors

   @param string source - 'config' or 'database'
   ========================================================================= #}

{% macro sourceBadge(source) %}
	{% set colors = {
		'config': '#f59e0b',
		'database': '#3b82f6',
	} %}
	{% set rgb = {
		'config': '245, 158, 11',
		'database': '59, 130, 246',
	} %}
	{% set textColors = {
		'config': '#78350f',
		'database': '#1e3a8a',
	} %}

	{% if source == 'config' %}
		<span class="status-label" style="background: rgba({{ rgb.config }}, 0.12);"><span class="status" style="background: {{ colors.config }};"></span><span class="status-label-text" style="color: {{ textColors.config }};">{{ "Config"|t('sms-manager') }}</span></span>
	{% else %}
		<span class="status-label" style="background: rgba({{ rgb.database }}, 0.12);"><span class="status" style="background: {{ colors.database }};"></span><span class="status-label-text" style="color: {{ textColors.database }};">{{ "Database"|t('sms-manager') }}</span></span>
	{% endif %}
{% endmacro %}

{# =========================================================================
   STATUS BADGE
   Renders Enabled/Disabled status badge

   @param bool enabled - true for enabled, false for disabled
   ========================================================================= #}

{% macro statusBadge(enabled) %}
	{% if enabled %}
		<span class="status-label teal"><span class="status teal"></span><span class="status-label-text">{{ 'Enabled'|t('sms-manager') }}</span></span>
	{% else %}
		<span class="status-label gray"><span class="status disabled"></span><span class="status-label-text">{{ 'Disabled'|t('sms-manager') }}</span></span>
	{% endif %}
{% endmacro %}

{# =========================================================================
   PROVIDER TYPE BADGE
   Renders provider type badge (mpp-sms, etc.) with built-in colors

   @param string providerType - 'mpp-sms', etc.
   @param string|null label - Optional custom label
   ========================================================================= #}

{% macro providerTypeBadge(providerType, label) %}
	{% set colors = {
		'mpp-sms': '#8b5cf6',
	} %}
	{% set rgb = {
		'mpp-sms': '139, 92, 246',
	} %}
	{% set textColors = {
		'mpp-sms': '#5b21b6',
	} %}
	{% set labels = {
		'mpp-sms': 'MPP-SMS',
	} %}

	{% set pColor = colors[providerType]|default('#9aa5b1') %}
	{% set pRgb = rgb[providerType]|default('154, 165, 177') %}
	{% set pTextColor = textColors[providerType]|default('#374151') %}
	{% set displayLabel = label|default(labels[providerType]|default(providerType|upper)) %}

	{% if providerType %}
		<span class="status-label" style="background: rgba({{ pRgb }}, 0.12); white-space: nowrap;">
			<span class="status" style="background: {{ pColor }};"></span>
			<span class="status-label-text" style="color: {{ pTextColor }};">{{ displayLabel }}</span>
		</span>
	{% else %}
		<span class="light">—</span>
	{% endif %}
{% endmacro %}

{# =========================================================================
   DEFAULT BADGE
   Renders a Default badge

   @param bool isDefault - true if default
   ========================================================================= #}

{% macro defaultBadge(isDefault) %}
	{% if isDefault %}
		<span class="status-label blue"><span class="status blue"></span><span class="status-label-text">{{ 'Default'|t('sms-manager') }}</span></span>
	{% endif %}
{% endmacro %}

{# =========================================================================
   TYPE BADGE
   Renders a Development or Production badge for sender IDs
   Development: pink/magenta, Production: cyan/sky blue

   @param bool isDev - true for Development, false for Production
   ========================================================================= #}

{% macro typeBadge(isDev) %}
	{% if isDev %}
		{% set color = '#ec4899' %}
		{% set rgb = '236, 72, 153' %}
		{% set textColor = '#9d174d' %}
		{% set label = 'Development'|t('sms-manager') %}
	{% else %}
		{% set color = '#0ea5e9' %}
		{% set rgb = '14, 165, 233' %}
		{% set textColor = '#0369a1' %}
		{% set label = 'Production'|t('sms-manager') %}
	{% endif %}
	<span class="status-label" style="background: rgba({{ rgb }}, 0.12);"><span class="status" style="background: {{ color }};"></span><span class="status-label-text" style="color: {{ textColor }};">{{ label }}</span></span>
{% endmacro %}

{# Alias for backward compatibility #}
{% macro testBadge(isDev) %}
	{% import _self as self %}
	{% if isDev %}
		{{ self.typeBadge(true) }}
	{% endif %}
{% endmacro %}

{# =========================================================================
   SOURCE FILTER MENU ITEMS
   Renders the Config Source filter section for dropdown menus

   @param string sourceFilter - current filter value ('all', 'config', 'database')
   @param string statusFilter - current status filter
   @param string search - current search query
   @param object extraParams - additional URL params { key: value }
   ========================================================================= #}

{% macro sourceFilterMenu(sourceFilter, statusFilter, search, extraParams) %}
	{% set colors = {
		'config': '#f59e0b',
		'database': '#3b82f6',
	} %}

	<li><hr class="padded"></li>
	<li class="menu-header">{{ 'Config Source'|t('sms-manager') }}</li>
	<li>
		<a class="{{ sourceFilter == 'all' ? 'sel' : '' }}" href="?status={{ statusFilter }}&source=all{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status all"></span>{{ 'All Sources'|t('sms-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ sourceFilter == 'config' ? 'sel' : '' }}" href="?status={{ statusFilter }}&source=config{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status" style="background: {{ sourceFilter == 'config' ? colors.config : '#aab6c1' }};"></span>{{ 'Config File'|t('sms-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ sourceFilter == 'database' ? 'sel' : '' }}" href="?status={{ statusFilter }}&source=database{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status" style="background: {{ sourceFilter == 'database' ? colors.database : '#aab6c1' }};"></span>{{ 'Database'|t('sms-manager') }}
		</a>
	</li>
{% endmacro %}

{# =========================================================================
   STATUS FILTER MENU ITEMS
   Renders the Status filter section for dropdown menus

   @param string statusFilter - current filter value ('all', 'enabled', 'disabled')
   @param string sourceFilter - current source filter
   @param string search - current search query
   @param object extraParams - additional URL params { key: value }
   ========================================================================= #}

{% macro statusFilterMenu(statusFilter, sourceFilter, search, extraParams) %}
	<li>
		<a class="{{ statusFilter == 'all' ? 'sel' : '' }}" href="?status=all&source={{ sourceFilter }}{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status all"></span>{{ 'All'|t('sms-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ statusFilter == 'enabled' ? 'sel' : '' }}" href="?status=enabled&source={{ sourceFilter }}{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status green"></span>{{ 'Enabled'|t('sms-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ statusFilter == 'disabled' ? 'sel' : '' }}" href="?status=disabled&source={{ sourceFilter }}{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status disabled"></span>{{ 'Disabled'|t('sms-manager') }}
		</a>
	</li>
{% endmacro %}

{# =========================================================================
   CONFIG INFO ICON
   Renders the info icon that shows config tooltip on hover

   @param string configDisplay - The raw config PHP code to show in tooltip
   ========================================================================= #}

{% macro configInfoIcon(configDisplay) %}
	<span class="config-info-icon" data-config="{{ configDisplay|e('html_attr') }}"></span>
{% endmacro %}

{# =========================================================================
   DISABLED CHECKBOX
   Renders a disabled checkbox for config-source items

   @param string title - Tooltip text explaining why it's disabled
   ========================================================================= #}

{% macro disabledCheckbox(title) %}
	<div class="checkbox disabled" title="{{ title }}" tabindex="-1" aria-checked="false" aria-disabled="true" role="checkbox" style="opacity: 0.4; cursor: not-allowed; pointer-events: none;"></div>
{% endmacro %}

{# =========================================================================
   PAGINATION INFO
   Renders the pagination info text (e.g., "1 – 50 of 120 items")

   @param int offset - Current offset
   @param int limit - Items per page
   @param int totalCount - Total items
   @param string singular - Singular item name
   @param string plural - Plural item name
   ========================================================================= #}

{% macro paginationInfo(offset, limit, totalCount, singular, plural) %}
	{% set endRange = min(offset + limit, totalCount) %}
	{% if totalCount == 0 %}
		{{ ('no ' ~ plural)|t('sms-manager') }}
	{% else %}
		{{ offset + 1 }} – {{ endRange }} of {{ totalCount }} {{ totalCount == 1 ? singular : plural }}
	{% endif %}
{% endmacro %}

{# =========================================================================
   SOURCE COLOR
   Returns the color for a source type (for use in filter menus)

   @param string sourceType - 'config' or 'database'
   @param string currentFilter - Currently selected filter value
   @return string - The hex color
   ========================================================================= #}

{% macro sourceColor(sourceType, currentFilter) %}
	{% set colors = {
		'config': '#f59e0b',
		'database': '#3b82f6',
	} %}
	{{- currentFilter == sourceType ? colors[sourceType]|default('#9aa5b1') : '#aab6c1' -}}
{% endmacro %}
